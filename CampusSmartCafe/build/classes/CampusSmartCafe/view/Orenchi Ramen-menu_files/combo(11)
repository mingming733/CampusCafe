YUI.add("flickr-people-getInfo-fetcher",function(e,t){"use strict";function n(e,t){var n={datecreate:1,extras:"icon_urls, safe_search"};YUI.Env.isServer&&e.id===t.request.probableUser&&(n.storage=1,n.extras+=", classic_user_id, active_group_membership, timezone_dst, unified_search_view_pref"),e.extras&&typeof e.extras=="string"&&e.extras.length>0&&(n.extras=n.extras+","+e.extras);if(e.id)n.user_id=e.id;else{if(!e.pathAlias)throw new Error("`fetch` is missing required params.");n.path_alias=e.pathAlias}return e.storage&&(n.storage=e.storage),n}function r(t,n,r){var i=t.apiResponse,s=t.personModelRegistry,o=t.personRelationshipModelRegistry,u=t.personProfileModelRegistry,a=t.personPreferencesModelRegistry,f=t.personGroupsModelRegistry,l=t.photostreamModelRegistry,c=t.personNotificationsModelRegistry,h,p=i.person,d,v=r.getViewer(),m=p.id;return s.exists(m)||s.add({id:m,pathAlias:p.pathAlias,username:p.username&&p.username._content,realname:p.realname&&p.realname._content,buddyicon:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(p.iconurls),isAdFree:p.isAdFree,isPro:p.ispro,canBuyPro:p.canBuyPro,location:p.location&&p.location._content,dateCreated:p.datecreate._content}),c.exists(m)?c.setValue(m,"unreadNotificationCount",3):c.add({id:m,unreadNotificationCount:0,unreadFlickrMailCount:0}),o.exists(m)||o.add({id:m,pathAlias:p.pathAlias,isContact:p.contact,isFriend:p.friend,isFamily:p.family,isIgnored:p.ignored,isIgnoredBy:p.ignoredby}),v&&v.signedIn&&m===v.nsid&&(d={id:m},p.safeSearch&&(d.safeSearch=(p.safeSearch||1)-1),p.viewPrefs&&p.viewPrefs.unifiedSearchViewPref&&(d.unifiedSearchViewPref=p.viewPrefs.unifiedSearchViewPref),a.exists(m)?a.setValues(m,d):a.add(d)),u.exists(m)||(h={id:m,coverPhotoUrls:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(p.coverphoto_url),photoCount:p.photos.count.content,location:p.location?p.location.content:null},p.storage&&(h.storageUsed=p.storage.used.content,h.storageTotal=p.storage.total.content),p.unreadMessages&&(h.unreadMessages=p.unreadMessages.content),u.add(h)),f.exists(m)||f.add({id:m,memberCount:p.groupMemberships?p.groupMemberships.member:null,moderatorCount:p.groupMemberships?p.groupMemberships.moderator:null,adminCount:p.groupMemberships?p.groupMemberships.admin:null,invitedCount:p.groupMemberships?p.groupMemberships.invited:null}),l.exists(m)||l.add({id:m,pathAlias:p.pathAlias,owner:s.proxy(m),totalItems:p.photos.count&&p.photos.count.content}),p}function i(n,r){var i=this,s=r.getViewer();return s&&s.signedIn&&(n.id===s.nsid||n.nsid===s.nsid)&&(n.storage=1),(new e.FlickrPromise({apiResponse:r.callAPI("flickr.people.getInfo",this._processParams(n,r)),personModelRegistry:r.getModelRegistry("person-models"),personRelationshipModelRegistry:r.getModelRegistry("person-relationship-models"),personProfileModelRegistry:r.getModelRegistry("person-profile-models"),personPreferencesModelRegistry:r.getModelRegistry("person-preferences-models"),personGroupsModelRegistry:r.getModelRegistry("person-groups-models"),photostreamModelRegistry:r.getModelRegistry("photostream-models"),personNotificationsModelRegistry:r.getModelRegistry("person-notifications-models")})).then(function(e){return i._processResponse(e,n,r)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-people-getInfo"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise"],optional:["person-models","person-relationship-models","person-preferences-models","person-profile-models","person-groups-models","photostream-models","api-helper"]});
YUI.add("person-model-helper",function(e){e.PersonModelHelper={attributes:{pathAlias:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||undefined},defaultFn:function(e){return e}},username:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},realname:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},displayname:{readOnly:!0,derivedBy:["username","realname"],getter:function(e,t){return this.getValue(t,"realname")||this.getValue(t,"username")}},nsid:{readOnly:!0,defaultFn:function(e){return e}},url:{readOnly:!0,derivedBy:["pathAlias"],defaultFn:function(e){var t=this.getValue(e,"pathAlias");return"/photos/"+t+"/"}},isMe:{readOnly:!0,defaultFn:function(e){var t=this.appContext.getViewer();return t.signedIn&&t.nsid===e}}}}},"@VERSION@",{requires:[]});
YUI.add("person-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)}},attributes:{pathAlias:e.PersonModelHelper.attributes.pathAlias,username:e.PersonModelHelper.attributes.username,realname:e.PersonModelHelper.attributes.realname,displayname:e.PersonModelHelper.attributes.displayname,nsid:e.PersonModelHelper.attributes.nsid,url:e.PersonModelHelper.attributes.url,isMe:e.PersonModelHelper.attributes.isMe,buddyicon:{},isPro:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},canBuyPro:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultFn:function(){return!1}},isAdFree:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isNoAds:{derivedBy:["isPro","isAdFree"],readOnly:!0,getter:function(e,t){var n=this.getValue(t,"isPro"),r=this.getValue(t,"isAdFree");return n||r}},dateCreated:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},location:{defaultFn:function(){return""}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher","attribute-helpers","person-model-helper"]});
YUI.add("flickr-photos-getHtmlMeta-fetcher",function(e,t){"use strict";function n(e,t){var n=e[0],r=e[1],i;n&&n.HTMLMETA&&(i={id:n.photoId,"og:title":n.HTMLMETA["og:title"],"og:description":n.HTMLMETA["og:description"],"og:type":n.HTMLMETA["og:type"],"og:url":n.HTMLMETA["og:url"],"og:site_name":n.HTMLMETA["og:site_name"],"og:image":n.HTMLMETA["og:image"],"og:image:width":n.HTMLMETA["og:image:width"],"og:image:height":n.HTMLMETA["og:image:height"],"flickr_photos:by":n.HTMLMETA["flickr_photos:by"],"flickr_photos:camera":n.HTMLMETA["flickr_photos:camera"],"flickr_photos:sets":n.HTMLMETA["flickr_photos:sets"],"flickr_photos:groups":n.HTMLMETA["flickr_photos:groups"],"flickr_photos:galleries":n.HTMLMETA["flickr_photos:galleries"],"twitter:card":n.HTMLMETA["twitter:card"],"twitter:site":n.HTMLMETA["twitter:site"],"twitter:app:name:iphone":n.HTMLMETA["twitter:app:name:iphone"],"twitter:description":n.HTMLMETA["twitter:description"],"twitter:app:url:iphone":n.HTMLMETA["twitter:app:url:iphone"],"twitter:creator":n.HTMLMETA["twitter:creator"]},r.exists(t.id)||r.add(i))}function r(n,r){var i=n.id,s={photo_id:i},o=this;return e.Promise.all([r.callAPI("flickr.photos.getHtmlMeta",s),r.getModelRegistry("photo-head-meta-models")]).then(function(e){return o._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-photos-getHtmlMeta"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-head-meta-models"]});
YUI.add("photo-head-meta-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getHtmlMeta"].run(t,this.appContext)}},getFieldsForDisplay:function(e){var t={},n=["og:title","og:description","og:type","og:url","og:site_name","og:image","og:image:width","og:image:height","flickr_photos:by","flickr_photos:camera","flickr_photos:sets","flickr_photos:groups","flickr_photos:galleries","twitter:card","twitter:site","twitter:app:name:iphone","twitter:description","twitter:app:url:iphone","twitter:creator","pinterest"],r=this;return n.forEach(function(n){var i=r.getValue(e,n);typeof i!="undefined"&&(t[n]=i)}),t},attributes:{"og:title":{setter:function(e){return e&&e.replace?e.replace(/"/g,"&quot;"):e}},"og:description":{setter:function(e){return e&&e.replace?e.replace(/"/g,"&quot;"):e}},"og:type":{},"og:url":{},"og:site_name":{},"og:image":{},"og:image:width":{},"og:image:height":{},"flickr_photos:by":{},"flickr_photos:camera":{},"flickr_photos:sets":{},"flickr_photos:groups":{},"flickr_photos:galleries":{},"twitter:card":{},"twitter:site":{},"twitter:app:name:iphone":{},"twitter:description":{setter:function(e){return e&&e.replace?e.replace(/"/g,"&quot;"):e}},"twitter:app:url:iphone":{},"twitter:creator":{},pinterest:{setter:function(e){return e}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getHtmlMeta-fetcher","flickr-photos-getInfo-fetcher","attribute-helpers"]});
YUI.add("photo-notes-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)}},attributes:{notes:{isListProxy:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-getInfo-fetcher"]});
YUI.add("flickr-photos-addNotes-creator",function(e,t){"use strict";function n(e){e.tags=e.tags||[];var t={};return t.photo_id=e.photoId,t.note_x=e.left,t.note_y=e.top,t.note_w=e.width,t.note_h=e.height,t.note_text=e.text,t}function r(e,t){var n=e[0],r=e[1],i=e[2],s=[];return i.exists(n.note.id)||i.add({id:n.note.id,left:t.noteLeft,top:t.noteTop,width:t.noteWidth,height:t.noteHeight,text:t.noteText}),s.push(i.proxy(n.note.id)),r.exists(t.photoId)?s.forEach(function(e){r.getValue(t.photoId,"notes").appendToList(e)}):r.add({id:t.photoId,notes:s}),s}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.photos.notes.add",this._processParams(n)),r.getModelRegistry("photo-notes-models"),r.getModelRegistry("note-models")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ModelCreators")["flickr-photos-addNotes"]={run:i,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise"],optional:["photo-notes-models","note-models"]});
YUI.add("flickr-photos-editNote-updater",function(e,t){"use strict";function n(e){var t={};return t.note_id=e.noteId,t.note_x=e.noteX,t.note_y=e.noteY,t.note_w=e.noteW,t.note_h=e.noteH,t.note_text=e.noteText,t}function r(n,r){return r.callAPI("flickr.photos.notes.edit",this._processParams(n)).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-photos-editNote"]={run:r,_processParams:n}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("flickr-photos-deleteNote-deletor",function(e,t){"use strict";function n(n,r){var i={};return i.note_id=n,r.callAPI("flickr.photos.notes.delete",i).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelDeletors")["flickr-photos-deleteNote"]={run:n}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("note-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{create:function(t){return e.ModelCreators["flickr-photos-addNotes"].run(t,this.appContext)},update:function(t,n){var r;return r={noteId:t,noteX:this.getValue(t,"left"),noteY:this.getValue(t,"top"),noteW:this.getValue(t,"width"),noteH:this.getValue(t,"height"),noteText:this.getValue(t,"text")},e.ModelUpdaters["flickr-photos-editNote"].run(r,this.appContext)},"delete":function(t){return e.ModelDeletors["flickr-photos-deleteNote"].run(t,this.appContext)}},attributes:{authorName:{setter:function(e){return e}},author:{setter:function(e){return e}},left:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},top:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},width:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},height:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},text:{setter:function(e){return e}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-addNotes-creator","flickr-photos-editNote-updater","flickr-photos-deleteNote-deletor","attribute-helpers"]});
YUI.add("flickr-photos-deleteAutotags-deletor",function(e,t){"use strict";function n(n,r){return r.callAPI("flickr.photos.deleteAutotags",n).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelDeletors")["flickr-photos-deleteAutotags"]={run:n}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("autotag-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{"delete":function(t){return e.ModelDeletors["flickr-photos-deleteAutotags"].run(t,this.appContext)}},attributes:{autotagValue:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},score:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},isPrivate:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},searchUrl:{derivedBy:["autotagValue"],readOnly:!0,defaultFn:function(e){var t=this.getValue(e,"autotagValue");return"/search/?tags="+t}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-deleteAutotags-deletor"]});
YUI.add("flickr-photos-getAutotags-fetcher",function(e,t){"use strict";function n(t,n){var r=t[0],i=t[1],s=t[2],o=0,u=[],a;return a={id:n},r.photo&&r.photo.autotag&&typeof r.photo.autotag!="undefined"&&(o=r.photo.autotag.length),o>0&&e.Array.each(r.photo.autotag,function(e){typeof e.content=="string"&&(s.exists(e.content)||s.add({id:e.content,autotagValue:e.content,score:e.score,isPrivate:e.isprivate}),u.push(s.proxy(e.content)))}),a.autotags={page:1,perPage:1e3,pageContent:u,totalItems:o},i.exists(n)?i.setValue(n,"autotags",a.autotags):i.add(a),i.proxy(n)}function r(n,r){var i=n.id,s={photo_id:i},o=this;return e.Promise.all([r.callAPI("flickr.photos.getAutotags",s),r.getModelRegistry("photo-autotags-models"),r.getModelRegistry("autotag-models")]).then(function(e){return o._processResponse(e,i)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-photos-getAutotags"]={run:r,_processResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["autotag-models","photo-autotags-models"]});
YUI.add("photo-autotags-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getAutotags"].run(t,this.appContext)},"delete":function(t){return e.ModelDeletors["flickr-photos-deleteAutotags"].run(t,this.appContext)}},attributes:{autotags:{isCollection:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-getAutotags-fetcher","flickr-photos-deleteAutotags-deletor"]});
YUI.add("flickr-photos-setPerms-updater",function(e,t){"use strict";function n(n,r){return r.callAPI("flickr.photos.setPerms",n).then(function(e){if(n.full_response)return e.photoIdsSent=n.photo_ids,e},function(e){throw n.full_response&&(e.photoIds=n.photo_ids),e}).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-photos-setPerms"]={run:n}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("flickr-photos-setMeta-updater",function(e,t){"use strict";function n(n,r){var i={};return n.fullResponse?(i.full_response=1,i.photo_ids=n.photoId):i.photo_id=n.photoId,typeof n.title!="undefined"&&(i.title=n.title),typeof n.description!="undefined"&&(i.description=n.description),e.Promise.all([r.callAPI("flickr.photos.setMeta",i),r.getModelRegistry("photo-models")]).then(function(e){var t=e[0],i=e[1];if(n.fullResponse){if("errors"in t)return t.api="setMeta",t}else{if(!i.exists(n.photoId))throw new Error("[flickr-photos-setMeta-updater] - Photo model can not be updated if it does not exist");!t.photo||!t.photo.title||!t.photo.description?r.warn("[flickr-photos-setMeta-updater] - No updated data returned from API."):i.setValues(n.photoId,{title:t.photo.title.content,description:t.photo.description.content})}},function(e){throw n.fullResponse&&(e.photoIds=n.photoId,e.returnApi="setMeta"),e}).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-photos-setMeta"]={run:n}},"@VERSION@",{requires:["flickr-promise","flog"],optional:[]});
YUI.add("flickr-photos-licenses-setLicense-updater",function(e,t){"use strict";function n(n,r){var i={};return n.fullResponse?(i.photo_ids=n.photoId,i.full_response=1):i.photo_id=n.photoId,i.license_id=n.license,r.callAPI("flickr.photos.licenses.setLicense",i).then(function(e){if("errors"in e)return e.api="setLicense",e},function(e){throw n.fullResponse&&(e.photoIds=n.photoId,e.returnApi="setLicense"),e}).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-photos-licenses-setLicense"]={run:n}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("flickr-photos-setSafetyLevel-updater",function(e,t){"use strict";function n(n,r){var i={};return n.fullResponse?(i.photo_ids=n.photoId,i.full_response=1):i.photo_id=n.photoId,i.safety_level=n.safetyLevel+1,r.callAPI("flickr.photos.setSafetyLevel",i).then(function(e){if("errors"in e)return e.api="setSafety",e},function(e){throw n.fullResponse&&(e.photoIds=n.photoId,e.returnApi="setSafety"),e}).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-photos-setSafetyLevel"]={run:n}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("photo-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)},update:function(t,n){var r=[];return("title"in n||"description"in n)&&r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:n.title?n.title.newVal:this.getValue(t,"title"),description:n.description?n.description.newVal:this.getValue(t,"description")},this.appContext)),"license"in n&&r.push(e.ModelUpdaters["flickr-photos-licenses-setLicense"].run({photoId:t,license:n.license.newVal},this.appContext)),"safetyLevel"in n&&r.push(e.ModelUpdaters["flickr-photos-setSafetyLevel"].run({photoId:t,safetyLevel:n.safetyLevel.newVal},this.appContext)),e.Promise.all(r)},batchUpdate:function(t,n){var r=[];return"safetyLevel"in n&&r.push(e.ModelUpdaters["flickr-photos-setSafetyLevel"].run({photoId:t,safetyLevel:parseInt(n.safetyLevel,10),fullResponse:1},this.appContext)),"title"in n&&"description"in n?r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:n.title,description:n.description,fullResponse:1},this.appContext)):"title"in n?r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,title:n.title,fullResponse:1},this.appContext)):"description"in n&&r.push(e.ModelUpdaters["flickr-photos-setMeta"].run({photoId:t,description:n.description,fullResponse:1},this.appContext)),"license"in n&&r.push(e.ModelUpdaters["flickr-photos-licenses-setLicense"].run({photoId:t,license:n.license,fullResponse:1},this.appContext)),e.Promise.all(r)}},getLargestSize:e.PhotoModelHelper.getLargestSize,getSizeToFit:e.PhotoModelHelper.getSizeToFit,getSizeIfExact:e.PhotoModelHelper.getSizeIfExact,isSizeSquare:e.PhotoModelHelper.isSizeSquare,isPhotoSquare:e.PhotoModelHelper.isPhotoSquare,getGuestpass:function(t){var n=this;return new e.Promise(function(e,r){n.getValue(t,"guestpass")?e():n.appContext.callAPI("flickr.sharing.createGuestpass",{photo:t}).then(function(r){n.setValue(t,"guestpass",r.guestpass.url),e()})})},attributes:{title:e.PhotoModelHelper.attributes.title,mediaType:e.PhotoModelHelper.attributes.mediaType,isVideo:e.PhotoModelHelper.attributes.isVideo,isOwner:e.PhotoModelHelper.attributes.isOwner,sizes:e.PhotoModelHelper.attributes.sizes,descendingSizes:e.PhotoModelHelper.attributes.descendingSizes,ascendingSizes:e.PhotoModelHelper.attributes.ascendingSizes,aspectRatio:e.PhotoModelHelper.attributes.aspectRatio,needsInterstitial:e.PhotoModelHelper.attributes.needsInterstitial,canComment:e.PhotoModelHelper.attributes.canComment,url:e.PhotoModelHelper.attributes.url,rotation:e.PhotoModelHelper.attributes.rotation,owner:{isModel:!0},engagement:{isModel:!0},description:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},isHD:{},secret:{},canAddMeta:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!0},license:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},isMarketplacePrintable:{defaultFn:function(e){return!1}},oWidth:{},oHeight:{},safetyLevel:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},guestpass:{},hasInvalidColorspaceForPrint:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","photo-model-helper","flickr-photos-getInfo-fetcher","flickr-photos-setPerms-updater","flickr-photos-setMeta-updater","flickr-photos-licenses-setLicense-updater","flickr-photos-setSafetyLevel-updater","attribute-helpers"]});
YUI.add("flickr-photos-getInfo-fetcher",function(e,t){"use strict";function n(t){var n,r;return n=["sizes","icon_urls","ignored","rev_ignored","tags","venue","datecreate","is_marketplace_printable","o_dims"].join(","),n=n+","+e.APIHelper.request.getRebootPhotoExtras(),r={datecreate:1,extras:n,photo_id:t.id,get_contexts:1,primary_photo_extras:"url_sq, url_t, url_s, url_m"},t.userId?r.user_id=t.userId:t.pathAlias&&(r.path_alias=t.pathAlias),t.context&&(r.context=t.context,r.num_prev=1,r.num_next=1),t.scrappy&&(e.APIHelper.request.addStaticMapsParams(r),delete r.get_contexts,delete r.primary_photo_extras,delete r.context),r}function r(t,n,r){var s=t.apiResponse,o=t.photoRegistry,u=t.personRegistry,a=t.personRelationshipRegistry,f=t.photoEngagementRegistry,l=t.photoStatsRegistry,c=t.photoPrivacyRegistry,h=t.photoTagsRegistry,p=t.tagRegistry,d=t.photoNotesRegistry,v=t.noteRegistry,m=t.photoGeoRegistry,g=t.photoLocationRegistry,y=t.photoHeadMetaRegistry,b=t.groupRegistry,w,E={},S,x,T,N,C,k,L=[],A=[],O,M,_;S={id:s.photo.id,title:s.photo.title.content,description:s.photo.description.content,sizes:e.APIHelper.response.parsePhotoSize(s.photo.sizes.size,!0),needsInterstitial:s.photo.needsInterstitial,canComment:s.photo.editability.cancomment,canAddMeta:s.photo.editability.canaddmeta,safetyLevel:s.photo.safetyLevel,license:s.photo.license,mediaType:s.photo.media,secret:s.photo.secret,isHD:e.APIHelper.response.isHD(s.photo.sizes.size),rotation:s.photo.rotation,hasInvalidColorspaceForPrint:s.photo.hasInvalidColorspaceForPrint,isMarketplacePrintable:s.photo.isMarketplacePrintable,oWidth:s.photo.oWidth?parseInt(s.photo.oWidth,10):"",oHeight:s.photo.oHeight?parseInt(s.photo.oHeight,10):""},x={id:s.photo.owner.nsid,username:s.photo.owner.username,realname:s.photo.owner.realname,pathAlias:s.photo.owner.pathAlias,buddyicon:e.APIHelper.response.agnosticizeFarmPathTransferProtocol(s.photo.owner.iconurls),isAdFree:s.photo.owner.isAdFree,isPro:s.photo.owner.ispro,dateCreated:s.photo.owner.datecreate,location:s.photo.owner.location},T={id:s.photo.owner.nsid,pathAlias:s.photo.owner.pathAlias,isContact:s.photo.contactIscontact,isFamily:s.photo.contactIsfamily,isFriend:s.photo.contactIsfriend,isIgnored:s.photo.owner.isignored,isIgnoredBy:s.photo.owner.revIgnored},N={id:s.photo.id,ownerNsid:s.photo.owner.nsid,isFaved:s.photo.isfavorite||!1,canShare:s.photo.usage.canshare,canDownload:s.photo.usage.candownload,commentCount:s.photo.comments.content,noteCount:s.photo.notes&&s.photo.notes.note&&s.photo.notes.note.length,faveCount:s.photo.countFaves,viewCount:s.photo.views},C={id:s.photo.id,dateTaken:s.photo.dates.taken,datePosted:s.photo.dates.posted,takenGranularity:s.photo.dates.takengranularity,isDateTakenUnknown:s.photo.datetakenunknown||s.photo.datetakenunknown==="1"||s.photo.datetakenunknown===1},O={id:s.photo.id,"og:title":s.photo.HTMLMETA["og:title"],"og:description":s.photo.HTMLMETA["og:description"],"og:type":s.photo.HTMLMETA["og:type"],"og:url":s.photo.HTMLMETA["og:url"],"og:site_name":s.photo.HTMLMETA["og:site_name"],"og:image":s.photo.HTMLMETA["og:image"],"og:image:width":s.photo.HTMLMETA["og:image:width"],"og:image:height":s.photo.HTMLMETA["og:image:height"],"flickr_photos:by":s.photo.HTMLMETA["flickr_photos:by"],"flickr_photos:camera":s.photo.HTMLMETA["flickr_photos:camera"],"flickr_photos:sets":s.photo.HTMLMETA["flickr_photos:sets"],"flickr_photos:groups":s.photo.HTMLMETA["flickr_photos:groups"],"flickr_photos:galleries":s.photo.HTMLMETA["flickr_photos:galleries"],"twitter:card":s.photo.HTMLMETA["twitter:card"],"twitter:site":s.photo.HTMLMETA["twitter:site"],"twitter:app:name:iphone":s.photo.HTMLMETA["twitter:app:name:iphone"],"twitter:description":s.photo.HTMLMETA["twitter:description"],"twitter:app:url:iphone":s.photo.HTMLMETA["twitter:app:url:iphone"],"twitter:creator":s.photo.HTMLMETA["twitter:creator"],pinterest:s.photo.HTMLMETA.pinterest},k={id:s.photo.id,isPublic:s.photo.visibility.ispublic,isVisibleByFriends:s.photo.visibility.isfriend,isVisibleByFamily:s.photo.visibility.isfamily,permAddMeta:s.photo.permissions?s.photo.permissions.permaddmeta:0,permComment:s.photo.permissions?s.photo.permissions.permcomment:0},s.photo&&s.photo.tags&&s.photo.tags.tag&&e.Array(s.photo.tags.tag).forEach(function(e){p.exists(e.id)||p.add({id:e.id,tagRaw:e.raw,tagValue:n.isFlipped("tags-charm")?e.content:e.content.replace(/\s/g,""),tagAuthorNSID:e.author,isMachineTag:e.machineTag}),L.push(p.proxy(e.id))}),s.photo&&s.photo.notes&&s.photo.notes.note&&e.Array(s.photo.notes.note).forEach(function(e){v.exists(e.id)||v.add({id:e.id,authorName:e.authorname,author:e.author,left:e.x,top:e.y,width:e.w,height:e.h,text:e.content}),A.push(v.proxy(e.id))}),M=e.ModelFetchers["flickr-photos-getLocation"].mapResponse(s,m),S.owner=u.exists(x.id)?u.proxy(x.id):u.add(x),S.engagement=f.exists(N.id)?f.proxy(N.id):f.add(N),a.exists(T.id)||a.add(T),_=o.exists(S.id)?o.proxy(S.id):o.add(S),s.photo.isMarketplacePrintable&&_.setValue("isMarketplacePrintable",!0),l.exists(S.id)||l.add(C),c.exists(S.id)||c.add(k),h.exists(S.id)||h.add({id:S.id,tags:L}),d.exists(S.id)||d.add({id:S.id,notes:A}),y.exists(S.id)||y.add(O),g.exists(S.id)||g.add(M),s.photo.contexts&&(w=t.contextsRegistry,E.faves=t.favoriteRegistry,E.gallery=t.galleryRegistry,E.pool=t.groupsPoolRegistry,E.set=t.setRegistry,E.stream=t.photostreamRegistry,i({photoModel:_,contextRegistries:E,contextsResponse:s.photo.contexts,personRegistry:u,contextsRegistry:w,photoEngagementRegistry:f,photoStatsRegistry:l,groupRegistry:b,apiParams:r}))}function i(t){var n=t.photoModel,r=t.contextRegistries,i=t.contextsResponse,s=t.personRegistry,o=t.contextsRegistry,u=t.photoEngagementRegistry,a=t.photoStatsRegistry,f=t.groupRegistry,l=t.apiParams,c=[];e.Object.each(r,function(t,r){i[r]&&e.Array.each(i[r],function(r){e.APIHelper.response.addContextToRegistry(r,t,s,f),c.push(t.proxy(r.id)),l.context&&function(){var i,o,f,c,h,p,d,v,m;i=t.getValue(r.id,"photoContextList"),o=i.hasMinBoundary?i.hasMinBoundary():!1
,f=i.hasMaxBoundary?i.hasMaxBoundary():!1,c=i.getList(),p=r.nextphotos,d=r.prevphotos,v=p?e.APIHelper.response.parsePhotos({photos:p.photo,personModelRegistry:s,photoModelRegistry:n.registry,photoEngagementModelRegistry:u,photoStatsModelRegistry:a}):[],m=d?e.APIHelper.response.parsePhotos({photos:d.photo,personModelRegistry:s,photoModelRegistry:n.registry,photoEngagementModelRegistry:u,photoStatsModelRegistry:a}):[];if(m.length||v.length)h=e.APIHelper.response.addOrReplaceListByContext({model:n,next:v,prev:m.reverse(),current:c,hasMin:o,hasMax:f,numNext:l.num_next,numPrev:l.num_prev});t.setValue(r.id,"photoContextList",h)}()})}),o.exists(n.id)||(o.add({id:n.id,totalGroups:i.pool?i.pool.length:0,totalSets:i.set?i.set.length:0,totalGalleries:i.gallery?i.gallery.length:0}),o.setValue(n.id,"contexts",c))}function s(n,r){var i=this,s;return r.flipper.isFlipped("enable-scrappy-photo-page")&&(n.scrappy=!0),s=this._processParams(n),(new e.FlickrPromise({apiResponse:r.callAPI("flickr.photos.getInfo",s),photoRegistry:r.getModelRegistry("photo-models"),personRegistry:r.getModelRegistry("person-models"),personRelationshipRegistry:r.getModelRegistry("person-relationship-models"),photoEngagementRegistry:r.getModelRegistry("photo-engagement-models"),photoStatsRegistry:r.getModelRegistry("photo-stats-models"),photoPrivacyRegistry:r.getModelRegistry("photo-privacy-models"),photoTagsRegistry:r.getModelRegistry("photo-tags-models"),tagRegistry:r.getModelRegistry("tag-models"),photoNotesRegistry:r.getModelRegistry("photo-notes-models"),noteRegistry:r.getModelRegistry("note-models"),photoGeoRegistry:r.getModelRegistry("photo-geo-models"),photoLocationRegistry:r.getModelRegistry("photo-location-models"),photoHeadMetaRegistry:r.getModelRegistry("photo-head-meta-models"),groupRegistry:r.getModelRegistry("group-models"),contextsRegistry:r.getModelRegistry("photo-contexts-models"),favoriteRegistry:r.getModelRegistry("favorite-models"),galleryRegistry:r.getModelRegistry("gallery-models"),groupsPoolRegistry:r.getModelRegistry("group-pool-models"),setRegistry:r.getModelRegistry("set-models"),photostreamRegistry:r.getModelRegistry("photostream-models")})).then(function(e){return i._processResponse(e,r.flipper,s)},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-photos-getInfo"]={run:s,_processParams:n,_processResponse:r}},"@VERSION@",{requires:["flickr-promise","api-helper","flickr-photos-getLocation-fetcher"],optional:["photo-models","person-models","person-relationship-models","photo-engagement-models","photo-stats-models","photo-geo-models","photo-location-models","photo-head-meta-models","note-models","photo-notes-models","autotag-models","photo-autotags-models"]});
YUI.add("photo-geo-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext).then(function(e){return e},function(){})}},attributes:{hasGeo:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},latitude:{},longitude:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getInfo-fetcher","attribute-helpers"]});
YUI.add("zoom-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,forceGpu:null,initializer:function(t){return this.photoId=t.photoId,this.disableIfSmall=!!t.disableIfSmall,YUI.Env.isServer||(e.config.win.location.search.indexOf("gpu=on")>-1?this.forceGpu=!0:e.config.win.location.search.indexOf("gpu=off")>-1&&(this.forceGpu=!1)),this},loadState:function(){var e=this;return this.appContext.getModel("photo-models",e.photoId).then(function(t){e.set("photo",t)})},buildContainer:function(){var e=this.templates("zoom")({})||"";return this.setContainerHTML(e),this},activate:function(){var t=this,n=t.getZoomKeyScope();return this.get("photo").getValue("needsInterstitial")||(this.parentViewContainer=this.get("container").ancestor(".view"),t.registerEventHandler(t.get("container").on("click",function(n){n.preventDefault(),t.cursorCoords=[n.pageX-e.config.win.pageXOffset,n.pageY-e.config.win.pageYOffset],e.rapidTracker.beacon(t.name,"zoomInClick"),t.zoomIn(t.cursorCoords)})),t.attachKeyEvent("down:90",e.betterThrottle(function(n){n.preventDefault(),e.rapidTracker.beacon(t.name,"zoomInKeyPress"),t.zoomIn()},100)),t.attachKeyEvent("down:90,27",e.betterThrottle(function(n){n.preventDefault(),e.rapidTracker.beacon(t.name,"zoomOutKeyPress"),t.zoomOut()},100),n),t.attachKeyEvent("down:37,38,39,40",e.betterThrottle(function(n){var r=[t.currentZoomRegion.left,t.currentZoomRegion.top],i=200;n.preventDefault();switch(n.button){case 37:r[0]+=i;break;case 38:r[1]+=i;break;case 39:r[0]-=i;break;case 40:r[1]-=i}e.rapidTracker.beacon(t.name,"zoomPanKeyPress"),t.panZoomNode(r)},16),n),t.registerEventHandler(t.appContext.flapp.before("activeViewChange",function(e){t.cleanUp()}))),this},getZoomEdgeMargin:function(){return 100},panZoomNodeToCurrentCoords:function(){if(!this.zoomedIn)return;var e=this.cursorCoords,t=this.getZoomPanCoordsForCursor(e);if(!t)return;this.panZoomNode(t)},panZoomNode:function(e){if(this.currentZoomRegion.left===e[0]&&this.currentZoomRegion.top===e[1])return;e=this.constrainPanCoords(e),this.currentZoomRegion.left=e[0],this.currentZoomRegion.top=e[1],this.pendingCoords=e},constrainPanCoords:function(e){var t,n,r,i,s=this.getZoomEdgeMargin(),o=[this.appContext.viewportData.getWidth(),this.appContext.viewportData.getHeight()],u=[this.zoomImageFullWidth,this.zoomImageFullHeight],a=[u[0]+2*s,u[1]+2*s];return t=0,n=o[0]-u[0]-2*s,r=0,i=o[1]-u[1]-2*s,e[0]>t?e[0]=t:e[0]<n&&(e[0]=n),e[1]>r?e[1]=r:e[1]<i&&(e[1]=i),u[0]<o[0]&&(e[0]=.5*(o[0]-a[0])),u[1]<o[1]&&(e[1]=.5*(o[1]-a[1])),e},getZoomPanCoordsForCursor:function(e){if(!e)return;var t=this.getZoomEdgeMargin(),n=[this.appContext.viewportData.getWidth(),this.appContext.viewportData.getHeight()],r=[this.zoomImageFullWidth,this.zoomImageFullHeight],i=[r[0]+2*t,r[1]+2*t],s=[e[0]/n[0],e[1]/n[1]],o=[s[0]*(n[0]-i[0]),s[1]*(n[1]-i[1])];return o},getZoomSmallRegion:function(){var t=this.get("container");return{left:t.getX()-e.config.win.pageXOffset-this.getZoomEdgeMargin(),top:t.getY()-e.config.win.pageYOffset-this.getZoomEdgeMargin(),width:parseInt(t.getStyle("width"),10),height:parseInt(t.getStyle("height"),10)}},resizeZoomNode:function(t,n){var r=this,i,s,o=e.config.win.performance&&e.config.win.performance.now;return n?new e.Promise(function(n,u){function a(e){var u=o?e-i:Date.now()-i,a=u/r.getZoomTransitionTime(),f;return a>=1?(f=t,r.isAnimatingZoom=!1,setTimeout(function(){n()},r.getZoomTransitionTime())):f={left:s.left+(t.left-s.left)*a,top:s.top+(t.top-s.top)*a,width:s.width+(t.width-s.width)*a,height:s.height+(t.height-s.height)*a},f}function f(n){var i=a(n);if(r.zoomingIn||r.zoomingOut)r.resizeZoomNode(i,!1),i!==t&&e.config.win.requestAnimationFrame(f)}r.isAnimatingZoom=!0,i=o?e.config.win.performance.now():Date.now(),s=r.currentZoomRegion,e.config.win.requestAnimationFrame(f)}):(this.currentZoomRegion=t,this.zoomPhotoContainerNode&&this.zoomPhotoContainerNode.setStyle("transform","translate("+t.left+"px, "+t.top+"px) scale("+t.width/this.zoomImageFullWidth+")"),e.Promise.resolve())},getZoomTransitionTime:function(){return 200},zoomOut:function(){var t=this,n=this.zoomNode;e.fire("flickr:removeKeyEventScope",this.getZoomKeyScope()),n.detachAll("mousemove"),this.mouseWheelHandler&&this.mouseWheelHandler.detach(),this.touchHandlers&&(this.touchHandlers.forEach(function(e){e.detach()}),delete this.touchHandlers),this.resizeZoomNode(this.getZoomSmallRegion(),!0),n.addClass("hiding"),this.zoomedIn=!1,this.zoomingIn=!1,this.zoomingOut=!0,setTimeout(function(){t.zoomingOut&&n&&n._node&&(t.parentViewContainer.removeClass("zoomed"),n.removeClass("hiding"),n.addClass("hidden"),setTimeout(function(){t.zoomingOut&&(t.cleanUp(),this.zoomingOut=!1)},200))},this.getZoomTransitionTime()+0),delete this.pendingCoords,delete this.currentCoords},cleanUp:function(){this.zoomNode&&(this.zoomNode.remove(!0),delete this.zoomNode,delete this.zoomPhotoContainerNode,this.zoomAnimationHandle.detach())},isImageReadyToDisplay:function(e){var t;return e?(t=new Image,t.src=e,t.complete||t.naturalWidth):!1},getZoomKeyScope:function(){return this.name+this._yuid},zoomMouseMoveHandler:function(t){this.cursorCoords=[t.pageX-e.config.win.pageXOffset,t.pageY-e.config.win.pageYOffset],this.isAnimatingZoom||this.panZoomNodeToCurrentCoords()},zoomScrollWheelHandler:function(e){e.preventDefault();var t=e.wheelDeltaX,n=e.wheelDeltaY;t===undefined&&(t=-e.deltaX||0),n===undefined&&(n=-e.deltaY||0),this.panZoomNode([this.currentZoomRegion.left+t,this.currentZoomRegion.top+n])},getSizes:function(){var e=this.parentViewContainer.one(".low-res-photo"),t=this.parentViewContainer.one(".main-photo");return{small:e?e.getAttribute("src"):"",medium:t?t.getAttribute("src"):"",large:this.getLargestSize()}},getLargestSize:function(){var e=this.appContext.flipper.isFlipped("enable-zoom-proxy"),t=this.appContext.flipper.config["zoom-proxy-prefix"],n;return e&&t?(n=this.get("photo").getLargestSize({excludeSizes:[]}),n.key==="o"&&(console.log("proxyPrefix",t,"largestSize.displayUrl"
,n.displayUrl),n.displayUrl=n.url=t+"http:"+n.displayUrl,console.log("proxying original",n.url))):n=this.get("photo").getLargestSize(),n},zoomIn:function(t){var n=this,r,i,s=this.getSizes(),o=this.isImageReadyToDisplay(s.medium),u=this.isImageReadyToDisplay(s.large.url),a=this.getZoomPixelRatio(),f=this.getZoomSmallRegion(),l,c,h,p=this.maxMsgNode;if(this.disableIfSmall&&f.width>=s.large.width){p||(p=this.maxMsgNode=e.Node.create('<div class="zoom-max-message">'+n.intlMessage({intlName:"photo-page-scrappy.ZOOM_MAX_MESSAGE"})+"</div>")),this.get("container").contains(p)||(p.addClass("hidden"),this.get("container").append(p)),setTimeout(function(){p&&p.inDoc()&&(p.removeClass("hidden"),this.maxMsgNodeHidingTimer&&(clearTimeout(this.maxMsgNodeHidingTimer),delete this.maxMsgNodeHidingTimer),this.maxMsgNodeHidingTimer=setTimeout(function(){p&&p.inDoc()&&p.addClass("hidden")},3e3))},0);return}e.fire("flickr:setKeyEventScope",this.getZoomKeyScope()),this.zoomingIn=!0,this.zoomAnimationHandle=e.AnimationManager.subscribe(function(){var r=n.getDeteriorationRateForEasing(),i,s,o={x:0,y:0},u={x:0,y:0},a={x:0,y:0};if(n.pendingCoords){o.x=parseInt(n.pendingCoords[0],10),o.y=parseInt(n.pendingCoords[1],10),n.currentCoords?(u.x=n.currentCoords[0],u.y=n.currentCoords[1]):(i=n.getZoomPanCoordsForCursor(t),s=n.constrainPanCoords(i),u.x=parseInt(s[0],10),u.y=parseInt(s[1],10)),o.x<u.x?a.x=u.x-Math.abs(o.x-u.x)*r:a.x=u.x+Math.abs(o.x-u.x)*r,o.y<u.y?a.y=u.y-Math.abs(o.y-u.y)*r:a.y=u.y+Math.abs(o.y-u.y)*r,a.x=parseInt(a.x,10),a.y=parseInt(a.y,10),a.x===u.x&&(o.x<u.x?a.x=u.x-1:o.x>u.x&&(a.x=u.x+1)),a.y===u.y&&(o.y<u.y?a.y=u.y-1:o.y>u.y&&(a.y=u.y+1));if(a.x!==o.x||a.y!==o.y)(n.forceGpu===!0||e.config.win.devicePixelRatio>1)&&n.forceGpu!==!1?n.zoomPhotoContainerNode.setStyle("transform","translate3d("+a.x+"px, "+a.y+"px, 0)"):n.zoomPhotoContainerNode.setStyle("transform","translate("+a.x+"px, "+a.y+"px)");n.currentCoords=[a.x,a.y],a.x===o.x&&a.y===o.y&&delete n.pendingCoords}}),this.zoomNode?(this.zoomingOut=!1,r=this.zoomNode,r.removeClass("hiding"),r.detachAll("mousemove"),this.mouseWheelHandler&&this.mouseWheelHandler.detach(),this.touchHandlers&&(this.touchHandlers.forEach(function(e){e.detach()}),delete this.touchHandlers)):r=this.zoomNode=e.Node.create(this.templates("zoom-modal")({smallSrc:o?s.medium:s.small,largeSrc:u?s.large.url:""})),i=this.zoomPhotoContainerNode=r.one(".zoom-photo-container"),this.zoomImageFullWidth=s.large.width/a,this.zoomImageFullHeight=s.large.height/a,t||(t=[this.appContext.viewportData.viewport.width/2,this.appContext.viewportData.viewport.height/2],n.cursorCoords=t),l=this.getZoomPanCoordsForCursor(t),l=this.constrainPanCoords(l),c={left:l[0],top:l[1],width:this.zoomImageFullWidth,height:this.zoomImageFullHeight},i.setStyle("transition","none"),this.resizeZoomNode(f,!1),r.on("click",function(t){if(n.zoomingIn)return;t.preventDefault(),e.rapidTracker.beacon(n.name,"zoomOutClick"),n.zoomOut()}),e.one("body").append(r),i.setStyle("width",c.width),i.setStyle("height",c.height),e.soon(function(){n.zoomingIn&&(r.removeClass("hidden"),i.setStyle("transition",""),"ontouchstart"in document?e.use("event-touch",function(){n.touchHandlers=[],n.touchHandlers.push(e.on("touchstart",function(e){e.changedTouches.length&&e.changedTouches.length===1&&(n.touching=[e.changedTouches[0].pageX,e.changedTouches[0].pageY])})),n.touchHandlers.push(e.on("touchmove",function(e){var t=e.pageX,r=e.pageY,i,s;n.touching&&e.changedTouches.length&&e.changedTouches.length===1&&(t=e.changedTouches[0].pageX,r=e.changedTouches[0].pageY,e.preventDefault(),i=t-n.touching[0],s=r-n.touching[1],n.touching=[t,r],n.panZoomNode([n.currentZoomRegion.left+i,n.currentZoomRegion.top+s]))})),n.touchHandlers.push(e.on("touchend",function(e){delete n.touching}))}):(r.on("mousemove",n.zoomMouseMoveHandler.bind(n)),n.mouseWheelHandler=function(){var e=n.zoomScrollWheelHandler.bind(n);return h="onwheel"in document.createElement("div")?"wheel":"mousewheel",document.addEventListener(h,e,!1),{detach:function(){document.removeEventListener(h,e,!1)}}}()),n.parentViewContainer.addClass("zoomed"),n.resizeZoomNode(c,!0).then(function(){n.zoomingIn&&(n.zoomingIn=!1,n.zoomedIn=!0,n.panZoomNodeToCurrentCoords(),u||i.append('<img src="'+s.large.url+'" class="zoom-large">'))}))})},getDeteriorationRateForEasing:function(){return.2},getZoomPixelRatio:function(){return 1}})},"@VERSION@",{requires:["flickr-view","better-throttle","flickr-promise","zoom-css","hermes-template-zoom","hermes-template-zoom-modal","animation-manager"],optional:["photo-models"],langBundles:["photo-page-scrappy"]});
